# NIER RAG Pipeline 테스트 쿼리 모음

## 📋 기능별 테스트 쿼리

### 1. **시계열 데이터 분석 (정규식 파싱)**
가장 간단한 형식 - 정규식으로 바로 파싱됨
```
437401,CO,2024010118,2024010214
```

### 2. **시계열 데이터 분석 (LLM 파싱)**
자연어 형태 - LLM이 구조화해서 파싱
```
437401 지역의 CO성분 24년 1월 27일 18시 부터 01월 28일 14시 까지 데이터 분석해줘
```

### 3. **연관 측정소 비교 테스트**
인접 측정소와 패턴 비교
```
111123 측정소 NO2 20240803 18시 ~ 20240910 14시 데이터에 이상이 있나?
```

### 4. **ChromaDB 유사 패턴 검색**
과거 유사 사례 검색
```
633122,O3,2024032010,2024032214
```

### 5. **일반 질문 처리**
RAG 없이 모델 직접 응답
```
미세먼지가 인체에 미치는 영향은?
```

### 6. **복합 테스트 쿼리**

#### A. PM2.5 이상 탐지
```
437401 측정소 PM25 24년 3월 15일 오전 9시부터 3월 16일 오후 6시까지 베이스라인 이상 징후 확인
```

#### B. 다중 성분 분석
```
111121,NO,2024010101,2024013124
```

#### C. 긴 기간 분석 (14일 추가 데이터 활용)
```
533112 지역 SO2 성분 2024년 2월 1일부터 2월 15일까지 분석
```

## 🔍 예상 응답 패턴

### 정상 데이터 응답 예시:
- "연관 측정소와의 유사도가 평균 범위 내에 있습니다"
- "베이스라인 이상 확률: 5% 미만"
- "유사한 기존 판정 결과: 정상 데이터"

### 이상 데이터 응답 예시:
- "연관 측정소와의 유사도가 평균보다 크게 낮음"
- "베이스라인 이상 확률: 70% 이상"
- "Z-score가 3 이상으로 강한 이상 징후"

## 🧪 기능 검증 포인트

### 1. **쿼리 파싱 확인**
로그에서 확인:
```
###PARSE_QUERY### user_input: [입력값]
###PARSE_QUERY### Ollama response: {'type': 'time_series', ...}
```

### 2. **데이터 조회 확인**
```
###FETCH_DATA###
CSV loaded successfully.
###PIPE### original_data: {'region': ..., 'values': '...'}
```

### 3. **연관 측정소 분석**
```
###PIPE### Station Related To [지역코드]: [연관 측정소 목록]
```

### 4. **임베딩 생성**
```
###EMBED_VALUES###
Embedding values...[시계열 데이터]
```

### 5. **최종 프롬프트 생성**
```
###BUILD_EXPLAIN_PROMPT###
- 유사한 기존 판정 결과
- 연관 측정소 비교 결과
- 베이스라인 이상 확률
```

## 💡 디버깅 팁

### 오류 발생 시 확인사항:

1. **"요청하신 시간 범위에 대해 데이터가 존재하지 않습니다"**
   - PostgreSQL 연결 실패
   - CSV 백업 파일에도 데이터 없음
   - 날짜 형식 오류

2. **"처리 중 오류가 발생했습니다"**
   - Ollama 연결 실패
   - ChromaDB 연결 실패
   - 임베딩 모델 로드 실패

3. **빈 응답**
   - Pipeline API 타임아웃
   - 메모리 부족
   - 프로세스 충돌

## 📊 성능 테스트

### 부하 테스트용 연속 쿼리:
```bash
# 다양한 지역과 성분으로 연속 테스트
for region in 437401 111123 633122; do
  for element in CO NO2 O3 PM10; do
    echo "Testing $region,$element,2024010101,2024010124"
  done
done
```

### 극단값 테스트:
```
# 매우 긴 기간 (처리 시간 테스트)
437401,CO,2024010101,2024033124

# 존재하지 않는 지역 (오류 처리 테스트)
999999,CO,2024010101,2024010124

# 잘못된 성분명 (파싱 오류 테스트)
437401,INVALID,2024010101,2024010124
```

## 🚀 권장 테스트 순서

1. **일반 질문** → LLM 연결 확인
2. **정규식 형식 쿼리** → 기본 파싱 확인
3. **자연어 시계열 쿼리** → LLM 파싱 확인
4. **연관 측정소 분석** → 전체 파이프라인 확인
5. **부하 테스트** → 안정성 확인

---

*이 쿼리들로 NIER RAG Pipeline의 모든 주요 기능을 검증할 수 있습니다.*